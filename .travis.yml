language: go
go:
- 1.14.x
git:
  depth: 1
notifications:
  email: false
env:
  global:
  - LANTERN_DBHOST=localhost
  - LANTERN_DBPORT=5432
  - LANTERN_DBUSER=lantern
  - LANTERN_DBPASSWORD=postgrespassword
  - LANTERN_DBUSER_READONLY=lantern_ro
  - LANTERN_DBPASSWORD_READONLY=postgrespassword_ro
  - LANTERN_DBUSER_READWRITE=lantern_rw
  - LANTERN_DBPASSWORD_READWRITE=lantern_rw
  - LANTERN_DBNAME=lantern
  - LANTERN_DBSSLMODE=disable
  - LANTERN_TEST_DBPASSWORD=postgrespassword
  - LANTERN_TEST_DBNAME=lantern_test
  - LANTERN_TEST_DBUSER=lantern
  - LANTERN_TEST_DBPASSWORD=postgrespassword
  - LANTERN_ENDPTLIST="/etc/lantern/EndpointSources.json"
  - LANTERN_QUSER=capabilityquerier
  - LANTERN_QPASSWORD=capabilityquerier
  - LANTERN_QHOST=lantern-back-end_lantern-mq_1
  - LANTERN_QPORT=5672
  - LANTERN_CAPQUERY_QNAME=capability-statements
  - LANTERN_CAPQUERY_NUMWORKERS=10
  - LANTERN_CAPQUERY_QRYINTVL=1440
  - LANTERN_TEST_QUSER=capabilityquerier
  - LANTERN_TEST_QPASSWORD=capabilityquerier
  - LANTERN_TEST_CAPQUERY_QNAME=capability-statements-test

before_script:
- go get ./...
- go get github.com/golangci/golangci-lint/cmd/golangci-lint
script:
- golangci-lint run -E gofmt
- make test_all
