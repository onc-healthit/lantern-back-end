name: Tests

on: [push]

jobs:
  test-unit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Go Unit Tests
        id: go-unit-tests
        run: make test
  test-integration:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Start System
        id: start-system
        run: docker-compose up -d --build postgres lantern-mq endpoint_manager capability_querier capability_receiver
      - name: Go Integration Tests
        id: go-integration-tests
        run: ./scripts/wait-for-it.sh localhost:5432 -- ./scripts/wait-for-it.sh localhost:15672 -- ./scripts/wait-for-it.sh localhost:5672 -- make test_int
      - name: Stop System
        run: make stop

